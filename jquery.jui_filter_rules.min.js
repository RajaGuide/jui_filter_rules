/**
 * @fileOverview jui_filter_rules - Create rules to filter dataset using jquery
 *               <p>License MIT
 *               <br />Copyright 2012 Christos Pontikis <a href="http://pontikis.net">http://pontikis.net</a>
 *               <br />Project page <a href="https://github.com/pontikis/jui_filter_rules">https://github.com/pontikis/jui_filter_rules</a>
 * @version 1.00
 * @author Christos Pontikis http://pontikis.net
 * @requires jquery, jquery-ui
 */
"use strict";(function(d){var a="jui_filter_rules",f="jui_filter_rules_status",e=["text","number","date"],n=[{type:"equal",accept_values:"yes",apply_to:["text","number","date"],group:"equality"},{type:"not_equal",accept_values:"yes",apply_to:["text","number","date"],group:"equality"},{type:"in",accept_values:"yes",apply_to:["text","number","date"],group:"multiple_choice"},{type:"not_in",accept_values:"yes",apply_to:["text","number","date"],group:"multiple_choice"},{type:"less",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"less_or_equal",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"greater",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"greater_or_equal",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"begins_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"not_begins_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"contains",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"not_contains",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"ends_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"not_ends_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"is_empty",accept_values:"no",apply_to:["text"],group:"empty_string"},{type:"is_not_empty",accept_values:"no",apply_to:["text"],group:"empty_string"},{type:"is_null",accept_values:"no",apply_to:["text","number","date"],group:"null"},{type:"is_not_null",accept_values:"no",apply_to:["text","number","date"],group:"null"}];var s={init:function(v){var w=this;return this.each(function(){var Q=w.data(a);if(typeof(Q)=="undefined"){var F=w.jui_filter_rules("getDefaults");Q=d.extend({},F,v)}else{Q=d.extend({},Q,v)}w.data(a,Q);if(typeof w.data(f)==="undefined"){w.data(f,{});w.data(f)["rule_id"]=0}var N=w.attr("id");c(N);var D=Q.filters,K=l(Q.filters_list_id_prefix,N)+"_",M=l(Q.operators_container_id_prefix,N)+"_",E=l(Q.operators_list_id_prefix,N)+"_",G=l(Q.filter_value_id_prefix,N)+"_",P=l(Q.group_tools_id_prefix,N)+"_",I=l(Q.rule_tools_id_prefix,N)+"_",A,C,R,z,J,U,T,y,L,O,B,x,H,S;if(w.data(f)["rule_id"]==0){if(D.length>0){w.html(m(N))}}w.addClass(Q.containerClass);L='[id^="'+P+'"]';w.off("change",L).on("change",L,function(){O=P.length;B=d(this).attr("id").substr(O);H=d(this).val();switch(H){case"rule_insert_before":d(this).closest("dt").parent("dl").before(k(N));break;case"rule_insert_after":d(this).closest("dt").parent("dl").after(k(N));break;case"rule_insert_inside":d(this).closest("dt").next("dd:first").find("ul:first").prepend(k(N));break;case"group_insert_before":d(this).closest("dl").before(m(N));break;case"group_insert_after":d(this).closest("dl").after(m(N));break;case"group_insert_inside":d(this).closest("dt").next("dd:first").find("ul:first").prepend(m(N));break;case"group_delete":d(this).closest("dl").remove();break}d(this).prop("selectedIndex",0)});L='[id^="'+I+'"]';w.off("change",L).on("change",L,function(){O=I.length;B=d(this).attr("id").substr(O);S=d(this).val();switch(S){case"rule_insert_before":d(this).closest("li").before(k(N));break;case"rule_insert_after":d(this).closest("li").after(k(N));break;case"rule_clear":A=K+B;R=M+B;z=G+B;J=d("#"+A);T=d("#"+R);y=d("#"+z);J.prop("selectedIndex",0);T.html("");y.html("");break;case"rule_delete":d(this).closest("li").remove();break;case"group_insert_before":d(this).closest("li").before(m(N));break;case"group_insert_after":d(this).closest("li").after(m(N));break}d(this).prop("selectedIndex",0)});L='[id^="'+K+'"]';w.off("change",L).on("change",L,function(){O=K.length;B=d(this).attr("id").substr(O);x=d(this).prop("selectedIndex")-1;R=M+B;C=E+B;z=G+B;T=d("#"+R);y=d("#"+z);if(x>=0){T.html(q(N,B,d(this).val()));U=d("#"+C);y.html(h(N,x,U.val()))}else{T.html("");y.html("")}});L='[id^="'+E+'"]';w.off("change",L).on("change",L,function(){O=E.length;B=d(this).attr("id").substr(O);A=K+B;C=E+B;z=G+B;J=d("#"+A);U=d("#"+C);y=d("#"+z);x=J.prop("selectedIndex")-1;if(x>=0){y.html(h(N,x,U.val()))}else{y.html("")}})})},getDefaults:function(){return{filters:[],containerClass:"filter_rules_container",rulesGroupContainerClass:"rules_group_container",rulesGroupHeaderClass:"rules_group_header",rulesGroupBodyClass:"rules_group_body",rulesGroupConditionContainerClass:"rules_group_condition_container",rulesGroupConditionListClass:"rules_group_condition_list",rulesGroupToolsContainerClass:"rules_group_tools_container",rulesGroupToolsListClass:"rules_group_tools_list",rulesListClass:"rules_list",rulesListLiClass:"rules_list_li",filterContainerClass:"filter_container",filterListClass:"filter_list",operatorsListContainerClass:"operators_list_container",operatorsListClass:"operators_list",filterValueContainerClass:"filter_value_container",filterInputTextClass:"filter_input_text",filterInputNumberClass:"filter_input_number",filterInputDateClass:"filter_input_date",ruleToolsContainerClass:"rule_tools_container",ruleToolsClass:"rule_tools_list",group_tools_id_prefix:"group_tools_",rule_li_id_prefix:"rule_",filters_list_id_prefix:"filters_list_",operators_container_id_prefix:"oper_wrap_",operators_list_id_prefix:"oper_list_",filter_value_id_prefix:"filter_value_",rule_tools_id_prefix:"rule_tools_",filter_ui_property_prefix:"flt_"}},getOption:function(v){var w=this;return w.data(a)[v]},getAllOptions:function(){var v=this;return v.data(a)},setOption:function(v,y,x){var w=this;w.data(a)[v]=y;if(x){w.jui_filter_rules("init")}},destroy:function(){return d(this).each(function(){var v=d(this);v.removeData(a)})},getRules:function(D,F){var z=this,A=z.attr("id"),w,C,E,v,J,H,I,y,x,G,B;w=z.find("dl").eq(D);C=w.find("dt:first").find("select:first").val();E=w.find("dd:first").find("ul:first").children().get();for(v in E){J=E[v];H={};if(J.tagName=="LI"){if(d(J).find("select:first").prop("selectedIndex")==0){continue}H.condition={};I=d(J).find("select:first").val();x=j(A,I);y=d(J).find("select").eq(1).val();H.condition.filterType=x.filterType;H.condition.field=x.field;H.condition.operator=y;H.condition.filterValue="value";H.logical_operator=C;F.push(H)}else{if(J.tagName=="DL"){H.condition=[];H.logical_operator=C;F.push(H);G=F.length-1;D=parseInt(D)+1;z.jui_filter_rules("getRules",D,F[G].condition);r(F)}}}return F}};var c=function(z){var y=d("#"+z),A,v,x=y.jui_filter_rules("getOption","filters"),w=[];for(v in x){w.push(x[v].filterName)}if(i(w)){A="Filternames are not unique...";y.html('<span style="color: red;">ERROR: '+A+"</span>");d.error(A)}};var l=function(w,v){return w+v};function i(y){var w={},v=y.length,z;for(z=0;z<v;z++){if(w[y[z]]===true){return true}w[y[z]]=true}return false}var r=function(v){var w,x;for(w in v){x=v[w].condition;if(d.isArray(x)){if(x.length==0){v.splice(w,1)}else{r(x)}}}};var j=function(y,z){var x=d("#"+y),v,w=x.jui_filter_rules("getOption","filters"),A=undefined;for(v in w){if(w[v].filterName==z){A=w[v];break}}return A};var u=function(z,A){var x=d("#"+z),w=x.jui_filter_rules("getOption","filters"),v,C,D,B,y=[],E;v=j(z,A);C=v.filterType;D=(v.excluded_operators===undefined?[]:v.excluded_operators);for(B in n){if(d.inArray(n[B].type,D)>-1){continue}if(d.inArray(C,n[B].apply_to)>-1){E={};E.operator_type=n[B].type;E.operator_label=rsc_jui_fr["operator_"+n[B].type];E.group=n[B].group;y.push(E)}}return y};var g=function(w){var v,x=undefined;for(v in n){if(n[v].type==w){x=n[v];break}}return x};var t=function(y){var w=d("#"+y),z=w.jui_filter_rules("getOption","rulesGroupConditionContainerClass"),v=w.jui_filter_rules("getOption","rulesGroupConditionListClass"),x="";x+='<div class="'+z+'">';x+='<select class="'+v+'">';x+='<option value="AND">'+rsc_jui_fr.rules_group_AND+":</option>";x+='<option value="OR">'+rsc_jui_fr.rules_group_OR+":</option>";x+="</select>";x+="</div>";return x};var o=function(w){var v=d("#"+w),A=parseInt(v.data(f)["rule_id"]),z=v.jui_filter_rules("getOption","rulesGroupToolsContainerClass"),D=v.jui_filter_rules("getOption","rulesGroupToolsListClass"),x=l(v.jui_filter_rules("getOption","group_tools_id_prefix"),w)+"_"+A,y=(A==0?' disabled="disabled"':""),B=(d.browser.msie&&parseInt(d.browser.version)<9?"":" tools_list_shrink"),C="";C+='<div class="'+z+'">';C+='<select id="'+x+'" class="'+D+B+'">';C+='<option value="please_select">'+rsc_jui_fr.tools_please_select+"</option>";C+='<optgroup label="'+rsc_jui_fr.rule+'">';C+='<option value="rule_insert_before"'+y+">"+rsc_jui_fr.rule_insert_before+"</option>";C+='<option value="rule_insert_after"'+y+">"+rsc_jui_fr.rule_insert_after+"</option>";C+='<option value="rule_insert_inside">'+rsc_jui_fr.rule_insert_inside+"</option>";C+="</optgroup>";C+='<optgroup label="'+rsc_jui_fr.group+'">';C+='<option value="group_insert_before"'+y+">"+rsc_jui_fr.group_insert_before+"</option>";C+='<option value="group_insert_after"'+y+">"+rsc_jui_fr.group_insert_after+"</option>";C+='<option value="group_insert_inside">'+rsc_jui_fr.group_insert_inside+"</option>";C+='<option value="group_delete"'+y+">"+rsc_jui_fr.group_delete+"</option>";C+="</optgroup>";C+="</select>";C+="</div>";return C};var p=function(z){var y=d("#"+z),D=parseInt(y.data(f)["rule_id"]),x=y.jui_filter_rules("getOption","filters"),C=y.jui_filter_rules("getOption","filterContainerClass"),w=y.jui_filter_rules("getOption","filterListClass"),v=l(y.jui_filter_rules("getOption","filters_list_id_prefix"),z)+"_"+D,A,B="";B+='<div class="'+C+'">';B+='<select id="'+v+'" class="'+w+'">';B+='<option value="no_filter">'+rsc_jui_fr.filter_please_select+"</option>";for(A in x){B+='<option value="'+x[A].filterName+'">'+x[A].filterLabel+"</option>"}B+="</select>";B+="</div>";return B};var q=function(z,E,C){var w=d("#"+z),y=w.jui_filter_rules("getOption","operatorsListClass"),A=l(w.jui_filter_rules("getOption","operators_list_id_prefix"),z)+"_",G=A+E,x,B,D,F="",v="";x=u(z,C);D=x.length;F+='<select id="'+G+'" class="'+y+'">';for(B in x){if(x[B].group!==v){F+='<optgroup label="&raquo;">';v=x[B].group}F+='<option value="'+x[B].operator_type+'">'+x[B].operator_label+"</option>";if(B<D-1&&x[parseInt(B)+1].group!==v){F+="</optgroup>"}}F+="</select>";return F};var h=function(z,G,B){var x=d("#"+z),v=x.jui_filter_rules("getOption","filters"),w,E="",F="",y,A,D,C;D=v[G].filterType;w=g(B);if(D=="text"){if(w.accept_values=="yes"){for(A in v[G].interface_common){C=v[G].interface_common[A].element;if(C=="input"){y=x.jui_filter_rules("getOption","filterInputTextClass");if(v[G].interface_common[A].className!==undefined){y=v[G].interface_common[A].className;if(y==""){y=x.jui_filter_rules("getOption","filterInputTextClass")}}F=' class="'+y+'"';E+='<input type="'+v[G].interface_common[A].type+'"'+F+">"}}}}if(D=="number"){if(w.accept_values=="yes"){for(A in v[G].interface_common){C=v[G].interface_common[A].element;if(C=="input"){y=x.jui_filter_rules("getOption","filterInputNumberClass");if(v[G].interface_common[A].className!==undefined){y=v[G].interface_common[A].className;if(y==""){y=x.jui_filter_rules("getOption","filterInputNumberClass")}}F=' class="'+y+'"';E+='<input type="'+v[G].interface_common[A].type+'"'+F+">"}}}}if(D=="date"){if(w.accept_values=="yes"){for(A in v[G].interface_common){C=v[G].interface_common[A].element;if(C=="input"){y=x.jui_filter_rules("getOption","filterInputDateClass");if(v[G].interface_common[A].className!==undefined){y=v[G].interface_common[A].className;if(y==""){y=x.jui_filter_rules("getOption","filterInputDateClass")}}F=' class="'+y+'"';E+='<input type="'+v[G].interface_common[A].type+'"'+F+">"}}}}return E};var b=function(z){var x=d("#"+z),w=parseInt(x.data(f)["rule_id"]),C=x.jui_filter_rules("getOption","ruleToolsContainerClass"),B=x.jui_filter_rules("getOption","ruleToolsClass"),v=l(x.jui_filter_rules("getOption","rule_tools_id_prefix"),z)+"_"+w,A=(d.browser.msie&&parseInt(d.browser.version)<9?"":" tools_list_shrink"),y="";y+='<div class="'+C+'">';y+='<select id="'+v+'" class="'+B+A+'">';y+='<option value="please_select">'+rsc_jui_fr.tools_please_select+"</option>";y+='<optgroup label="'+rsc_jui_fr.rule+'">';y+='<option value="rule_insert_before">'+rsc_jui_fr.rule_insert_before+"</option>";y+='<option value="rule_insert_after">'+rsc_jui_fr.rule_insert_after+"</option>";y+='<option value="rule_clear">'+rsc_jui_fr.rule_clear+"</option>";y+='<option value="rule_delete">'+rsc_jui_fr.rule_delete+"</option>";y+="</optgroup>";y+='<optgroup label="'+rsc_jui_fr.group+'">';y+='<option value="group_insert_before">'+rsc_jui_fr.group_insert_before+"</option>";y+='<option value="group_insert_after">'+rsc_jui_fr.group_insert_after+"</option>";y+="</optgroup>";y+="</select>";y+="</div>";return y};var m=function(B){var z=d("#"+B),A=z.jui_filter_rules("getOption","rulesGroupContainerClass"),y=z.jui_filter_rules("getOption","rulesGroupHeaderClass"),x=z.jui_filter_rules("getOption","rulesGroupBodyClass"),v=z.jui_filter_rules("getOption","rulesListClass"),w="";w+='<dl class="'+A+'">';w+='<dt class="'+y+'">';w+=t(B);w+=o(B);w+="</dt>";w+='<dd class="'+x+'">';w+='<ul class="'+v+'">';w+=k(B);w+="</ul>";w+="</dd>";w+="</dl>";return w};var k=function(y){var x=d("#"+y),B=x.jui_filter_rules("getOption","rulesListLiClass"),A=x.jui_filter_rules("getOption","operatorsListContainerClass"),z=x.jui_filter_rules("getOption","filterValueContainerClass"),F=l(x.jui_filter_rules("getOption","rule_li_id_prefix"),y)+"_",E=l(x.jui_filter_rules("getOption","operators_container_id_prefix"),y)+"_",w=l(x.jui_filter_rules("getOption","filter_value_id_prefix"),y)+"_",D,H,G,v="";var C=parseInt(x.data(f)["rule_id"])+1;x.data(f)["rule_id"]=C;H=E+C;G=w+C;D=F+C;v+='<li id="'+D+'" class="'+B+'">';v+=p(y);v+='<div id="'+H+'" class="'+A+'">';v+="</div>";v+='<div id="'+G+'" class="'+z+'">';v+="</div>";v+=b(y);v+="</li>";return v};d.fn.jui_filter_rules=function(w){if(this.size()!=1){var v="You must use this plugin ("+a+") with a unique element (at once)";this.html('<span style="color: red;">ERROR: '+v+"</span>");d.error(v)}if(s[w]){return s[w].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof w==="object"||!w){return s.init.apply(this,arguments)}else{d.error("Method "+w+" does not exist on jQuery."+a)}}}})(jQuery);
