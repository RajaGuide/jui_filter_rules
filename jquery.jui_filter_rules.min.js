/**
 * @fileOverview jui_filter_rules - Create rules to filter dataset using jquery
 *               <p>License MIT
 *               <br />Copyright 2012 Christos Pontikis <a href="http://pontikis.net">http://pontikis.net</a>
 *               <br />Project page <a href="https://github.com/pontikis/jui_filter_rules">https://github.com/pontikis/jui_filter_rules</a>
 * @version 1.00
 * @author Christos Pontikis http://pontikis.net
 * @requires jquery, jquery-ui
 */
"use strict";(function(d){var a="jui_filter_rules",f="jui_filter_rules_status",e=["text","number","date"],n=[{type:"equal",accept_values:"yes",apply_to:["text","number","date"],group:"equality"},{type:"not_equal",accept_values:"yes",apply_to:["text","number","date"],group:"equality"},{type:"in",accept_values:"yes",apply_to:["text","number","date"],group:"multiple_choice"},{type:"not_in",accept_values:"yes",apply_to:["text","number","date"],group:"multiple_choice"},{type:"less",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"less_or_equal",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"greater",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"greater_or_equal",accept_values:"yes",apply_to:["number","date"],group:"inequality"},{type:"begins_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"not_begins_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"contains",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"not_contains",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"ends_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"not_ends_with",accept_values:"yes",apply_to:["text"],group:"substring"},{type:"is_empty",accept_values:"no",apply_to:["text"],group:"empty_string"},{type:"is_not_empty",accept_values:"no",apply_to:["text"],group:"empty_string"},{type:"is_null",accept_values:"no",apply_to:["text","number","date"],group:"null"},{type:"is_not_null",accept_values:"no",apply_to:["text","number","date"],group:"null"}];var s={init:function(w){var x=this;return this.each(function(){var R=x.data(a);if(typeof(R)=="undefined"){var G=x.jui_filter_rules("getDefaults");R=d.extend({},G,w)}else{R=d.extend({},R,w)}x.data(a,R);if(typeof x.data(f)==="undefined"){x.data(f,{});x.data(f)["rule_id"]=0}var O=x.attr("id");c(O);var E=R.filters,L=l(R.filters_list_id_prefix,O)+"_",N=l(R.operators_container_id_prefix,O)+"_",F=l(R.operators_list_id_prefix,O)+"_",H=l(R.filter_value_id_prefix,O)+"_",Q=l(R.group_tools_id_prefix,O)+"_",J=l(R.rule_tools_id_prefix,O)+"_",B,D,S,A,K,V,U,z,M,P,C,y,I,T;if(x.data(f)["rule_id"]==0){if(E.length>0){x.html(m(O))}}x.addClass(R.containerClass);M='[id^="'+Q+'"]';x.off("change",M).on("change",M,function(){P=Q.length;C=d(this).attr("id").substr(P);I=d(this).val();switch(I){case"rule_insert_before":d(this).closest("dt").parent("dl").before(k(O));break;case"rule_insert_after":d(this).closest("dt").parent("dl").after(k(O));break;case"rule_insert_inside":d(this).closest("dt").next("dd:first").find("ul:first").prepend(k(O));break;case"group_insert_before":d(this).closest("dl").before(m(O));break;case"group_insert_after":d(this).closest("dl").after(m(O));break;case"group_insert_inside":d(this).closest("dt").next("dd:first").find("ul:first").prepend(m(O));break;case"group_delete":d(this).closest("dl").remove();break}d(this).prop("selectedIndex",0)});M='[id^="'+J+'"]';x.off("change",M).on("change",M,function(){P=J.length;C=d(this).attr("id").substr(P);T=d(this).val();switch(T){case"rule_insert_before":d(this).closest("li").before(k(O));break;case"rule_insert_after":d(this).closest("li").after(k(O));break;case"rule_clear":B=L+C;S=N+C;A=H+C;K=d("#"+B);U=d("#"+S);z=d("#"+A);K.prop("selectedIndex",0);U.html("");z.html("");break;case"rule_delete":d(this).closest("li").remove();break;case"group_insert_before":d(this).closest("li").before(m(O));break;case"group_insert_after":d(this).closest("li").after(m(O));break}d(this).prop("selectedIndex",0)});M='[id^="'+L+'"]';x.off("change",M).on("change",M,function(){P=L.length;C=d(this).attr("id").substr(P);y=d(this).prop("selectedIndex")-1;S=N+C;D=F+C;A=H+C;U=d("#"+S);z=d("#"+A);if(y>=0){U.html(q(O,C,d(this).val()));V=d("#"+D);h(O,C,d(this).val(),V.val())}else{U.html("");z.html("")}});M='[id^="'+F+'"]';x.off("change",M).on("change",M,function(){P=F.length;C=d(this).attr("id").substr(P);B=L+C;D=F+C;A=H+C;K=d("#"+B);V=d("#"+D);z=d("#"+A);y=K.prop("selectedIndex")-1;if(y>=0){h(O,C,K.val(),V.val())}else{z.html("")}})})},getDefaults:function(){return{filters:[],containerClass:"filter_rules_container",rulesGroupContainerClass:"rules_group_container",rulesGroupHeaderClass:"rules_group_header",rulesGroupBodyClass:"rules_group_body",rulesGroupConditionContainerClass:"rules_group_condition_container",rulesGroupConditionListClass:"rules_group_condition_list",rulesGroupToolsContainerClass:"rules_group_tools_container",rulesGroupToolsListClass:"rules_group_tools_list",rulesListClass:"rules_list",rulesListLiClass:"rules_list_li",filterContainerClass:"filter_container",filterListClass:"filter_list",operatorsListContainerClass:"operators_list_container",operatorsListClass:"operators_list",filterValueContainerClass:"filter_value_container",filterInputTextClass:"filter_input_text",filterInputNumberClass:"filter_input_number",filterInputDateClass:"filter_input_date",filterInputCheckboxClass:"filter_input_checkbox",filterInputRadioClass:"filter_input_radio",filterSelectClass:"filter_select",filterGroupListClass:"filter_group_list",filterGroupListItemHorizontalClass:"filter_group_list_item_horizontal",filterGroupListItemVerticalClass:"filter_group_list_item_vertical",ruleToolsContainerClass:"rule_tools_container",ruleToolsClass:"rule_tools_list",group_tools_id_prefix:"group_tools_",rule_li_id_prefix:"rule_",filters_list_id_prefix:"filters_list_",operators_container_id_prefix:"oper_wrap_",operators_list_id_prefix:"oper_list_",filter_value_id_prefix:"filter_value_",filter_element_id_prefix:"flt_",filter_element_name_prefix:"flt_name_",rule_tools_id_prefix:"rule_tools_"}},getOption:function(w){var x=this;return x.data(a)[w]},getAllOptions:function(){var w=this;return w.data(a)},setOption:function(w,z,y){var x=this;x.data(a)[w]=z;if(y){x.jui_filter_rules("init")}},destroy:function(){return d(this).each(function(){var w=d(this);w.removeData(a)})},getRules:function(E,G){var A=this,C=A.attr("id"),x,D,F,B,w,K,I,J,z,y,H;x=A.find("dl").eq(E);D=x.find("dt:first").find("select:first").val();F=x.find("dd:first").find("ul:first").children().get();B=F.length;for(w=0;w<B;w++){K=F[w];I={};if(K.tagName=="LI"){if(d(K).find("select:first").prop("selectedIndex")==0){continue}I.condition={};J=d(K).find("select:first").val();y=j(C,J);z=d(K).find("select").eq(1).val();I.condition.filterType=y.filterType;I.condition.field=y.field;I.condition.operator=z;I.condition.filterValue="value";I.logical_operator=D;G.push(I)}else{if(K.tagName=="DL"){I.condition=[];I.logical_operator=D;G.push(I);H=G.length-1;E=parseInt(E)+1;A.jui_filter_rules("getRules",E,G[H].condition);r(G)}}}return G}};var c=function(B){var A=d("#"+B),C,w,z=A.jui_filter_rules("getOption","filters"),y=z.length,x=[];for(w=0;w<y;w++){x.push(z[w].filterName)}if(i(x)){C="Filternames are not unique...";A.html('<span style="color: red;">ERROR: '+C+"</span>");d.error(C)}};var l=function(x,w){return x+w};function i(z){var y={},w=z.length,A;for(A=0;A<w;A++){if(y[z[A]]===true){return true}y[z[A]]=true}return false}var t=function(x){var w={},y;for(y in x){if(x.hasOwnProperty(y)){if(x[y]!==""){w[y]=x[y]}}}return w};var r=function(x){var y,z,w=x.length;for(y=0;y<w;y++){z=x[y].condition;if(d.isArray(z)){if(z.length==0){x.splice(y,1)}else{r(z)}}}};var j=function(A,B){var z=d("#"+A),w,y=z.jui_filter_rules("getOption","filters"),x=y.length,C=undefined;for(w=0;w<x;w++){if(y[w].filterName==B){C=y[w];break}}return C};var v=function(A,C){var y=d("#"+A),x=y.jui_filter_rules("getOption","filters"),w,D,F,E=n.length,B,z=[],G;w=j(A,C);D=w.filterType;F=(w.excluded_operators===undefined?[]:w.excluded_operators);for(B=0;B<E;B++){if(d.inArray(n[B].type,F)>-1){continue}if(d.inArray(D,n[B].apply_to)>-1){G={};G.operator_type=n[B].type;G.operator_label=rsc_jui_fr["operator_"+n[B].type];G.group=n[B].group;z.push(G)}}return z};var g=function(y){var x,w=n.length,z=undefined;for(x=0;x<w;x++){if(n[x].type==y){z=n[x];break}}return z};var u=function(z){var x=d("#"+z),A=x.jui_filter_rules("getOption","rulesGroupConditionContainerClass"),w=x.jui_filter_rules("getOption","rulesGroupConditionListClass"),y="";y+='<div class="'+A+'">';y+='<select class="'+w+'">';y+='<option value="AND">'+rsc_jui_fr.rules_group_AND+":</option>";y+='<option value="OR">'+rsc_jui_fr.rules_group_OR+":</option>";y+="</select>";y+="</div>";return y};var o=function(x){var w=d("#"+x),B=parseInt(w.data(f)["rule_id"]),A=w.jui_filter_rules("getOption","rulesGroupToolsContainerClass"),E=w.jui_filter_rules("getOption","rulesGroupToolsListClass"),y=l(w.jui_filter_rules("getOption","group_tools_id_prefix"),x)+"_"+B,z=(B==0?' disabled="disabled"':""),C=(d.browser.msie&&parseInt(d.browser.version)<9?"":" tools_list_shrink"),D="";D+='<div class="'+A+'">';D+='<select id="'+y+'" class="'+E+C+'">';D+='<option value="please_select">'+rsc_jui_fr.tools_please_select+"</option>";D+='<optgroup label="'+rsc_jui_fr.rule+'">';D+='<option value="rule_insert_before"'+z+">"+rsc_jui_fr.rule_insert_before+"</option>";D+='<option value="rule_insert_after"'+z+">"+rsc_jui_fr.rule_insert_after+"</option>";D+='<option value="rule_insert_inside">'+rsc_jui_fr.rule_insert_inside+"</option>";D+="</optgroup>";D+='<optgroup label="'+rsc_jui_fr.group+'">';D+='<option value="group_insert_before"'+z+">"+rsc_jui_fr.group_insert_before+"</option>";D+='<option value="group_insert_after"'+z+">"+rsc_jui_fr.group_insert_after+"</option>";D+='<option value="group_insert_inside">'+rsc_jui_fr.group_insert_inside+"</option>";D+='<option value="group_delete"'+z+">"+rsc_jui_fr.group_delete+"</option>";D+="</optgroup>";D+="</select>";D+="</div>";return D};var p=function(A){var z=d("#"+A),E=parseInt(z.data(f)["rule_id"]),y=z.jui_filter_rules("getOption","filters"),F=y.length,D=z.jui_filter_rules("getOption","filterContainerClass"),x=z.jui_filter_rules("getOption","filterListClass"),w=l(z.jui_filter_rules("getOption","filters_list_id_prefix"),A)+"_"+E,B,C="";C+='<div class="'+D+'">';C+='<select id="'+w+'" class="'+x+'">';C+='<option value="no_filter">'+rsc_jui_fr.filter_please_select+"</option>";for(B=0;B<F;B++){C+='<option value="'+y[B].filterName+'">'+y[B].filterLabel+"</option>"}C+="</select>";C+="</div>";return C};var q=function(A,G,D){var x=d("#"+A),J=l(x.jui_filter_rules("getOption","operators_container_id_prefix"),A)+"_"+G,E=d("#"+J),z=x.jui_filter_rules("getOption","operatorsListClass"),B=l(x.jui_filter_rules("getOption","operators_list_id_prefix"),A)+"_",I=B+G,y,C,F,H="",w="";y=v(A,D);F=y.length;H+='<select id="'+I+'" class="'+z+'">';for(C=0;C<F;C++){if(y[C].group!==w){H+='<optgroup label="&raquo;">';w=y[C].group}H+='<option value="'+y[C].operator_type+'">'+y[C].operator_label+"</option>";if(C<F-1&&y[parseInt(C)+1].group!==w){H+="</optgroup>"}}H+="</select>";E.html(H)};var h=function(N,D,W,L){var ae=d("#"+N),af=g(L),Y=l(ae.jui_filter_rules("getOption","filter_value_id_prefix"),N)+"_"+D,ak=d("#"+Y),J=ae.jui_filter_rules("getOption","filters"),S=t(j(N,W)),O=S.filterType,x=S.filter_interface,A=x.length,ah,y,z,G,F="",T,H,K=["id","name"],M="",ag,Z,Q,ac,R="",w="no",ad,C=ae.jui_filter_rules("getOption","filterGroupListClass"),ab=ae.jui_filter_rules("getOption","filterGroupListItemHorizontalClass"),X=ae.jui_filter_rules("getOption","filterGroupListItemVerticalClass"),B="";if(af.accept_values!=="yes"){ak.html("");return true}if(S.hasOwnProperty("lookup_values_ajax_url")){R=S.lookup_values_ajax_url;d.ajax({url:R,success:(function(al){ag=d.parseJSON(al);ak.html(P())})})}else{if(S.hasOwnProperty("lookup_values")){ag=S.lookup_values}ak.html(P())}function P(){for(ah=0;ah<A;ah++){y=x[ah].filter_element;T=t(x[ah].filter_element_properties);if(y=="input"){F=T.type}I();if(F=="checkbox"||F=="radio"){ai();Z=ag.length;B+='<ul class="'+C+'">';for(Q=0;Q<Z;Q++){B+='<li class="'+ad+'">';B+="<"+y;V(Q);B+=' id="'+z+'"';if(F=="radio"){aa();B+=' name="'+G+'"'}aj();B+=' value="'+ag[Q]["lk_value"]+'"';ac=(ag[Q]["lk_selected"]=="yes"?' checked="checked"':"");B+=ac;B+=">";B+='<label for="'+z+'">'+ag[Q]["lk_option"]+"</label>";B+="</li>"}B+="</ul>"}else{B+="<"+y;V(ah);B+=' id="'+z+'"';aj();B+=">";if(y=="select"){E()}}}return B}function V(al){z=l(ae.jui_filter_rules("getOption","filter_element_id_prefix"),N)+"_"+D+(al>0?"_"+al:"")}function aa(){G=l(ae.jui_filter_rules("getOption","filter_element_name_prefix"),N)+"_"+D}function I(){if(y=="input"){if(F=="text"){K=["id","name"]}else{if(F=="radio"){K=["id","name","value","checked"]}else{if(F=="checkbox"){K=["id","name","value","checked"]}}}}else{if(y=="select"){K=["id","name","value"]}}}function U(){var al="";M="";if(y=="input"){if(F=="text"){if(O=="text"){al="filterInputTextClass"}else{if(O=="number"){al="filterInputNumberClass"}else{if(O=="date"){al="filterInputDateClass"}}}}else{if(F=="radio"){al="filterInputRadioClass"}else{if(F=="checkbox"){al="filterInputCheckboxClass"}}}}else{if(y=="select"){al="filterSelectClass"}}if(al!==""){M=ae.jui_filter_rules("getOption",al)}}function aj(){for(H in T){if(T.hasOwnProperty(H)){if(d.inArray(H,K)>-1){continue}B+=" "+H+'="'+T[H]+'"'}}if(!T.hasOwnProperty("class")){U();if(M!==""){B+=' class="'+M+'"'}}}function E(){Z=ag.length;for(Q=0;Q<Z;Q++){ac=(ag[Q]["lk_selected"]=="yes"?' selected="selected"':"");B+='<option value="'+ag[Q]["lk_value"]+'"'+ac+">"+ag[Q]["lk_option"]+"</option>"}B+="</select>"}function ai(){w="no";if(x[ah].hasOwnProperty("vertical_orientation")){w=x[ah].vertical_orientation}ad=(w=="yes"?X:ab)}return true};var b=function(A){var y=d("#"+A),x=parseInt(y.data(f)["rule_id"]),D=y.jui_filter_rules("getOption","ruleToolsContainerClass"),C=y.jui_filter_rules("getOption","ruleToolsClass"),w=l(y.jui_filter_rules("getOption","rule_tools_id_prefix"),A)+"_"+x,B=(d.browser.msie&&parseInt(d.browser.version)<9?"":" tools_list_shrink"),z="";z+='<div class="'+D+'">';z+='<select id="'+w+'" class="'+C+B+'">';z+='<option value="please_select">'+rsc_jui_fr.tools_please_select+"</option>";z+='<optgroup label="'+rsc_jui_fr.rule+'">';z+='<option value="rule_insert_before">'+rsc_jui_fr.rule_insert_before+"</option>";z+='<option value="rule_insert_after">'+rsc_jui_fr.rule_insert_after+"</option>";z+='<option value="rule_clear">'+rsc_jui_fr.rule_clear+"</option>";z+='<option value="rule_delete">'+rsc_jui_fr.rule_delete+"</option>";z+="</optgroup>";z+='<optgroup label="'+rsc_jui_fr.group+'">';z+='<option value="group_insert_before">'+rsc_jui_fr.group_insert_before+"</option>";z+='<option value="group_insert_after">'+rsc_jui_fr.group_insert_after+"</option>";z+="</optgroup>";z+="</select>";z+="</div>";return z};var m=function(C){var A=d("#"+C),B=A.jui_filter_rules("getOption","rulesGroupContainerClass"),z=A.jui_filter_rules("getOption","rulesGroupHeaderClass"),y=A.jui_filter_rules("getOption","rulesGroupBodyClass"),w=A.jui_filter_rules("getOption","rulesListClass"),x="";x+='<dl class="'+B+'">';x+='<dt class="'+z+'">';x+=u(C);x+=o(C);x+="</dt>";x+='<dd class="'+y+'">';x+='<ul class="'+w+'">';x+=k(C);x+="</ul>";x+="</dd>";x+="</dl>";return x};var k=function(z){var y=d("#"+z),C=y.jui_filter_rules("getOption","rulesListLiClass"),B=y.jui_filter_rules("getOption","operatorsListContainerClass"),A=y.jui_filter_rules("getOption","filterValueContainerClass"),G=l(y.jui_filter_rules("getOption","rule_li_id_prefix"),z)+"_",F=l(y.jui_filter_rules("getOption","operators_container_id_prefix"),z)+"_",x=l(y.jui_filter_rules("getOption","filter_value_id_prefix"),z)+"_",E,I,H,w="";var D=parseInt(y.data(f)["rule_id"])+1;y.data(f)["rule_id"]=D;I=F+D;H=x+D;E=G+D;w+='<li id="'+E+'" class="'+C+'">';w+=p(z);w+='<div id="'+I+'" class="'+B+'">';w+="</div>";w+='<div id="'+H+'" class="'+A+'">';w+="</div>";w+=b(z);w+="</li>";return w};d.fn.jui_filter_rules=function(x){if(this.size()!=1){var w="You must use this plugin ("+a+") with a unique element (at once)";this.html('<span style="color: red;">ERROR: '+w+"</span>");d.error(w)}if(s[x]){return s[x].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof x==="object"||!x){return s.init.apply(this,arguments)}else{d.error("Method "+x+" does not exist on jQuery."+a)}}}})(jQuery);
