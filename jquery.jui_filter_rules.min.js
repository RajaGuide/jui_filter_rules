/**
 * @fileOverview jui_filter_rules - Create rules to filter dataset using jquery
 *               <p>License MIT
 *               <br />Copyright 2012 Christos Pontikis <a href="http://pontikis.net">http://pontikis.net</a>
 *               <br />Project page <a href="https://github.com/pontikis/jui_filter_rules">https://github.com/pontikis/jui_filter_rules</a>
 * @version 1.00
 * @author Christos Pontikis http://pontikis.net
 * @requires jquery, jquery-ui
 */
"use strict";(function(d){var a="jui_filter_rules",f="jui_filter_rules_status",e=["text","number","date"],m=[{type:"equal",accept_values:"yes",apply_to:["text","number","date"],start_a_group:"yes"},{type:"not_equal",accept_values:"yes",apply_to:["text","number","date"],start_a_group:"no"},{type:"in",accept_values:"yes",apply_to:["text","number","date"],start_a_group:"yes"},{type:"not_in",accept_values:"yes",apply_to:["text","number","date"],start_a_group:"no"},{type:"less",accept_values:"yes",apply_to:["number","date"],start_a_group:"yes"},{type:"less_or_equal",accept_values:"yes",apply_to:["number","date"],start_a_group:"no"},{type:"greater",accept_values:"yes",apply_to:["number","date"],start_a_group:"no"},{type:"greater_or_equal",accept_values:"yes",apply_to:["number","date"],start_a_group:"no"},{type:"between",accept_values:"yes",apply_to:["number","date"],start_a_group:"yes"},{type:"not_between",accept_values:"yes",apply_to:["number","date"],start_a_group:"no"},{type:"begins_with",accept_values:"yes",apply_to:["text"],start_a_group:"yes"},{type:"not_begins_with",accept_values:"yes",apply_to:["text"],start_a_group:"no"},{type:"contains",accept_values:"yes",apply_to:["text"],start_a_group:"no"},{type:"not_contains",accept_values:"yes",apply_to:["text"],start_a_group:"no"},{type:"ends_with",accept_values:"yes",apply_to:["text"],start_a_group:"no"},{type:"not_ends_with",accept_values:"yes",apply_to:["text"],start_a_group:"no"},{type:"is_empty",accept_values:"no",apply_to:["text"],start_a_group:"yes"},{type:"is_not_empty",accept_values:"no",apply_to:["text"],start_a_group:"no"},{type:"is_null",accept_values:"no",apply_to:["text","number","date"],start_a_group:"yes"},{type:"is_not_null",accept_values:"no",apply_to:["text","number","date"],start_a_group:"no"}];var r={init:function(u){var v=this;return this.each(function(){var O=v.data(a);if(typeof(O)=="undefined"){var E=v.jui_filter_rules("getDefaults");O=d.extend({},E,u)}else{O=d.extend({},O,u)}v.data(a,O);if(typeof v.data(f)==="undefined"){v.data(f,{});v.data(f)["rule_id"]=0}var L=v.attr("id");var C=O.filters,J=k(O.filters_list_id_prefix,L)+"_",D=k(O.operators_list_id_prefix,L)+"_",F=k(O.filter_value_id_prefix,L)+"_",N=k(O.group_tools_id_prefix,L)+"_",H=k(O.rule_tools_id_prefix,L)+"_",z,B,y,I,Q,x,K,M,A,w,G,P;if(v.data(f)["rule_id"]==0){if(C.length>0){v.html(l(L))}}v.addClass(O.containerClass);K='[id^="'+N+'"]';v.off("change",K).on("change",K,function(){M=N.length;A=d(this).attr("id").substr(M);G=d(this).val();switch(G){case"rule_insert_before":d(this).closest("dt").parent("dl").before(j(L));break;case"rule_insert_after":d(this).closest("dt").parent("dl").after(j(L));break;case"rule_insert_inside":d(this).closest("dt").next("dd:first").find("ul:first").prepend(j(L));break;case"group_insert_before":d(this).closest("dl").before(l(L));break;case"group_insert_after":d(this).closest("dl").after(l(L));break;case"group_insert_inside":d(this).closest("dt").next("dd:first").find("ul:first").prepend(l(L));break;case"group_delete":d(this).closest("dl").remove();break}d(this).prop("selectedIndex",0)});K='[id^="'+H+'"]';v.off("change",K).on("change",K,function(){M=H.length;A=d(this).attr("id").substr(M);P=d(this).val();switch(P){case"rule_insert_before":d(this).closest("li").before(j(L));break;case"rule_insert_after":d(this).closest("li").after(j(L));break;case"rule_clear":z=J+A;B=D+A;y=F+A;I=d("#"+z);Q=d("#"+B);x=d("#"+y);I.prop("selectedIndex",0);Q.html("");x.html("");break;case"rule_delete":d(this).closest("li").remove();break;case"group_insert_before":d(this).closest("li").before(l(L));break;case"group_insert_after":d(this).closest("li").after(l(L));break}d(this).prop("selectedIndex",0)});K='[id^="'+J+'"]';v.off("change",K).on("change",K,function(){M=J.length;A=d(this).attr("id").substr(M);w=d(this).prop("selectedIndex")-1;B=D+A;y=F+A;Q=d("#"+B);x=d("#"+y);if(w>=0){Q.html(p(C[w].filterType));x.html(h(L,w,Q.val()))}else{Q.html("");x.html("")}});K='[id^="'+D+'"]';v.off("change",K).on("change",K,function(){M=D.length;A=d(this).attr("id").substr(M);z=J+A;B=D+A;y=F+A;I=d("#"+z);Q=d("#"+B);x=d("#"+y);w=I.prop("selectedIndex")-1;if(w>=0){x.html(h(L,w,Q.val()))}else{x.html("")}})})},getDefaults:function(){return{filters:[],containerClass:"filter_rules_container",rulesGroupContainerClass:"rules_group_container",rulesGroupHeaderClass:"rules_group_header",rulesGroupBodyClass:"rules_group_body",rulesGroupConditionContainerClass:"rules_group_condition_container",rulesGroupConditionListClass:"rules_group_condition_list",rulesGroupToolsContainerClass:"rules_group_tools_container",rulesGroupToolsListClass:"rules_group_tools_list",rulesListClass:"rules_list",rulesListLiClass:"rules_list_li",filterContainerClass:"filter_container",filterListClass:"filter_list",operatorContainerClass:"operator_container",filterValueContainerClass:"filter_value_container",filterInputTextClass:"filter_input_text",filterInputNumberClass:"filter_input_number",filterInputDateClass:"filter_input_date",ruleToolsContainerClass:"rule_tools_container",ruleToolsClass:"rule_tools_list",group_tools_id_prefix:"group_tools_",rule_li_id_prefix:"rule_",filters_list_id_prefix:"filters_list_",operators_list_id_prefix:"oper_list_",filter_value_id_prefix:"filter_value_",rule_tools_id_prefix:"rule_tools_"}},getOption:function(u){var v=this;return v.data(a)[u]},getAllOptions:function(){var u=this;return u.data(a)},setOption:function(u,x,w){var v=this;v.data(a)[u]=x;if(w){v.jui_filter_rules("init")}},destroy:function(){return d(this).each(function(){var u=d(this);u.removeData(a)})},getRules:function(C,E){var y=this,z=y.attr("id"),v,B,D,u,I,G,H,x,w,F,A;v=y.find("dl").eq(C);B=v.find("dt:first").find("select:first").val();D=v.find("dd:first").find("ul:first").children().get();for(u in D){I=D[u];G={};if(I.tagName=="LI"){if(d(I).find("select:first").prop("selectedIndex")==0){continue}G.condition={};H=d(I).find("select:first").val();w=i(z,H);x=d(I).find("select").eq(1).val();G.condition.filterType=w.filterType;G.condition.field=w.field;G.condition.operator=x;G.condition.filterValue="value";G.logical_operator=B;E.push(G)}else{if(I.tagName=="DL"){G.condition=[];G.logical_operator=B;E.push(G);F=E.length-1;C=parseInt(C)+1;y.jui_filter_rules("getRules",C,E[F].condition);q(E)}}}return E}};var c=function(u){};var k=function(v,u){return v+u};var q=function(u){var v,w;for(v in u){w=u[v].condition;if(d.isArray(w)){if(w.length==0){u.splice(v,1)}else{q(w)}}}};var i=function(x,y){var w=d("#"+x),u,v=w.jui_filter_rules("getOption","filters"),z=undefined;for(u in v){if(v[u].filterName==y){z=v[u];break}}return z};var t=function(u){var v,x=[],w={};for(v in m){if(d.inArray(u,m[v].apply_to)>-1){w={};w.operator_type=m[v].type;w.operator_label=rsc_jui_fr["operator_"+m[v].type];w.start_a_group=m[v].start_a_group;x.push(w)}}return x};var g=function(v){var u,w=undefined;for(u in m){if(m[u].type==v){w=m[u];break}}return w};var s=function(x){var v=d("#"+x),y=v.jui_filter_rules("getOption","rulesGroupConditionContainerClass"),u=v.jui_filter_rules("getOption","rulesGroupConditionListClass"),w="";w+='<div class="'+y+'">';w+='<select class="'+u+'">';w+='<option value="AND">'+rsc_jui_fr.rules_group_AND+":</option>";w+='<option value="OR">'+rsc_jui_fr.rules_group_OR+":</option>";w+="</select>";w+="</div>";return w};var n=function(v){var u=d("#"+v),z=parseInt(u.data(f)["rule_id"]),y=u.jui_filter_rules("getOption","rulesGroupToolsContainerClass"),C=u.jui_filter_rules("getOption","rulesGroupToolsListClass"),w=k(u.jui_filter_rules("getOption","group_tools_id_prefix"),v)+"_"+z,x=(z==0?' disabled="disabled"':""),A=(d.browser.msie&&parseInt(d.browser.version)<9?"":" tools_list_shrink"),B="";B+='<div class="'+y+'">';B+='<select id="'+w+'" class="'+C+A+'">';B+='<option value="please_select">'+rsc_jui_fr.tools_please_select+"</option>";B+='<optgroup label="'+rsc_jui_fr.rule+'">';B+='<option value="rule_insert_before"'+x+">"+rsc_jui_fr.rule_insert_before+"</option>";B+='<option value="rule_insert_after"'+x+">"+rsc_jui_fr.rule_insert_after+"</option>";B+='<option value="rule_insert_inside">'+rsc_jui_fr.rule_insert_inside+"</option>";B+="</optgroup>";B+='<optgroup label="'+rsc_jui_fr.group+'">';B+='<option value="group_insert_before"'+x+">"+rsc_jui_fr.group_insert_before+"</option>";B+='<option value="group_insert_after"'+x+">"+rsc_jui_fr.group_insert_after+"</option>";B+='<option value="group_insert_inside">'+rsc_jui_fr.group_insert_inside+"</option>";B+='<option value="group_delete"'+x+">"+rsc_jui_fr.group_delete+"</option>";B+="</optgroup>";B+="</select>";B+="</div>";return B};var o=function(y){var x=d("#"+y),C=parseInt(x.data(f)["rule_id"]),w=x.jui_filter_rules("getOption","filters"),B=x.jui_filter_rules("getOption","filterContainerClass"),v=x.jui_filter_rules("getOption","filterListClass"),u=k(x.jui_filter_rules("getOption","filters_list_id_prefix"),y)+"_"+C,z,A="";A+='<div class="'+B+'">';A+='<select id="'+u+'" class="'+v+'">';A+='<option value="no_filter">'+rsc_jui_fr.filter_please_select+"</option>";for(z in w){A+='<option value="'+w[z].filterName+'">'+w[z].filterLabel+"</option>"}A+="</select>";A+="</div>";return A};var p=function(v){var y={},x,u,w="";y=t(v);u=y.length;for(x in y){if(y[x].start_a_group=="yes"){w+='<optgroup label="&raquo;" class="operator_list_option_group">'}w+='<option value="'+y[x].operator_type+'" class="operator_list_option">'+y[x].operator_label+"</option>";if(x<u-1&&y[parseInt(x)+1].start_a_group=="yes"){w+="</optgroup>"}}return w};var h=function(y,F,A){var w=d("#"+y),u=w.jui_filter_rules("getOption","filters"),v,D="",E="",x,z,C,B;C=u[F].filterType;v=g(A);if(C=="text"){if(v.accept_values=="yes"){for(z in u[F].interface_common){B=u[F].interface_common[z].element;if(B=="input"){x=w.jui_filter_rules("getOption","filterInputTextClass");if(u[F].interface_common[z].className!==undefined){x=u[F].interface_common[z].className;if(x==""){x=w.jui_filter_rules("getOption","filterInputTextClass")}}E=' class="'+x+'"';D+='<input type="'+u[F].interface_common[z].type+'"'+E+">"}}}}if(C=="number"){if(v.accept_values=="yes"){for(z in u[F].interface_common){B=u[F].interface_common[z].element;if(B=="input"){x=w.jui_filter_rules("getOption","filterInputNumberClass");E=' class="'+x+'"';D+='<input type="'+u[F].interface_common[z].type+'"'+E+">"}}}}return D};var b=function(y){var w=d("#"+y),v=parseInt(w.data(f)["rule_id"]),B=w.jui_filter_rules("getOption","ruleToolsContainerClass"),A=w.jui_filter_rules("getOption","ruleToolsClass"),u=k(w.jui_filter_rules("getOption","rule_tools_id_prefix"),y)+"_"+v,z=(d.browser.msie&&parseInt(d.browser.version)<9?"":" tools_list_shrink"),x="";x+='<div class="'+B+'">';x+='<select id="'+u+'" class="'+A+z+'">';x+='<option value="please_select">'+rsc_jui_fr.tools_please_select+"</option>";x+='<optgroup label="'+rsc_jui_fr.rule+'">';x+='<option value="rule_insert_before">'+rsc_jui_fr.rule_insert_before+"</option>";x+='<option value="rule_insert_after">'+rsc_jui_fr.rule_insert_after+"</option>";x+='<option value="rule_clear">'+rsc_jui_fr.rule_clear+"</option>";x+='<option value="rule_delete">'+rsc_jui_fr.rule_delete+"</option>";x+="</optgroup>";x+='<optgroup label="'+rsc_jui_fr.group+'">';x+='<option value="group_insert_before">'+rsc_jui_fr.group_insert_before+"</option>";x+='<option value="group_insert_after">'+rsc_jui_fr.group_insert_after+"</option>";x+="</optgroup>";x+="</select>";x+="</div>";return x};var l=function(A){var y=d("#"+A),z=y.jui_filter_rules("getOption","rulesGroupContainerClass"),x=y.jui_filter_rules("getOption","rulesGroupHeaderClass"),w=y.jui_filter_rules("getOption","rulesGroupBodyClass"),u=y.jui_filter_rules("getOption","rulesListClass"),v="";v+='<dl class="'+z+'">';v+='<dt class="'+x+'">';v+=s(A);v+=n(A);v+="</dt>";v+='<dd class="'+w+'">';v+='<ul class="'+u+'">';v+=j(A);v+="</ul>";v+="</dd>";v+="</dl>";return v};var j=function(y){var w=d("#"+y),B=w.jui_filter_rules("getOption","rulesListLiClass"),x=w.jui_filter_rules("getOption","operatorContainerClass"),z=w.jui_filter_rules("getOption","filterValueContainerClass"),F=k(w.jui_filter_rules("getOption","rule_li_id_prefix"),y)+"_",A=k(w.jui_filter_rules("getOption","operators_list_id_prefix"),y)+"_",v=k(w.jui_filter_rules("getOption","filter_value_id_prefix"),y)+"_",E,D,G,u="";var C=parseInt(w.data(f)["rule_id"])+1;w.data(f)["rule_id"]=C;D=A+C;G=v+C;E=F+C;u+='<li id="'+E+'" class="'+B+'">';u+=o(y);u+='<div class="'+x+'">';u+='<select id="'+D+'"></select>';u+="</div>";u+='<div id="'+G+'" class="'+z+'">';u+="</div>";u+=b(y);u+="</li>";return u};d.fn.jui_filter_rules=function(v){if(this.size()!=1){var u="You must use this plugin ("+a+") with a unique element (at once)";this.html('<span style="color: red;">ERROR: '+u+"</span>");d.error(u)}if(r[v]){return r[v].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof v==="object"||!v){return r.init.apply(this,arguments)}else{d.error("Method "+v+" does not exist on jQuery."+a)}}}})(jQuery);
